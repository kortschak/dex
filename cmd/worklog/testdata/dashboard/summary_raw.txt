gen_testdata -cen 2023-12-31 -tz +10:30 -radius 7 -tmplt template.json data.json

summary_data -rules rules.toml -raw=true -data data.json dates:?tz=%2b10:30&start=2023-07-01&end=2024-06-30
cmp stdout want.json

-- rules.toml --
[afk.afk]
src = """
{
	"bucket": bucket,
	"data":   data,
}
"""
[afk.locked]
src = """
{
	"bucket": bucket,
	"data":   {
		"activity": data.locked ? "locked" : "not-locked",
		"afk":      data.locked,
	},
}
"""
-- template.json --
{
	"buckets": {
		"afk": {
			"id": "afk_localhost",
			"name": "afk",
			"type": "afk",
			"client": "worklog",
			"hostname": "localhost",
			"created": "0001-01-01T00:00:00Z"
		},
		"window": {
			"id": "window_localhost",
			"name": "window",
			"type": "window",
			"client": "worklog",
			"hostname": "localhost",
			"created": "0001-01-01T00:00:00Z"
		}
	},
	"offsets": [
		0,
		3600000000000,
		82800000000000
	],
	"pattern": [
		{
			"duration": 360000000000,
			"afk": {
				"afk": true,
				"locked": true
			}
		},
		{
			"duration": 360000000000,
			"afk": {
				"afk": false,
				"locked": false
			},
			"window": {
				"app": "terminal",
				"title": "Terminal"
			}
		},
		{
			"afk": {
				"afk": false,
				"locked": false
			},
			"window": {
				"app": "terminal",
				"title": "Terminal"
			}
		},
		{
			"duration": 360000000000,
			"afk": {
				"afk": false,
				"locked": false
			},
			"window": {
				"app": "editor",
				"title": "Text Editor"
			}
		},
		{
			"duration": 360000000000,
			"afk": {
				"afk": true,
				"locked": false
			},
			"window": {
				"app": "terminal",
				"title": "Terminal"
			}
		},
		{
			"duration": 360000000000,
			"afk": {
				"afk": true,
				"locked": true
			}
		}
	]
}
-- want.json --
{
	"start": "2023-07-01T00:00:00+10:30",
	"end": "2024-06-30T23:59:59.999999999+10:30",
	"period": {
		"at_keyboard": [
			{
				"start": "2023-12-24T00:06:00+10:30",
				"end": "2023-12-24T00:24:00+10:30"
			},
			{
				"start": "2023-12-24T01:06:00+10:30",
				"end": "2023-12-24T01:24:00+10:30"
			},
			{
				"start": "2023-12-24T23:06:00+10:30",
				"end": "2023-12-24T23:24:00+10:30"
			},
			{
				"start": "2023-12-25T00:06:00+10:30",
				"end": "2023-12-25T00:24:00+10:30"
			},
			{
				"start": "2023-12-25T01:06:00+10:30",
				"end": "2023-12-25T01:24:00+10:30"
			},
			{
				"start": "2023-12-25T23:06:00+10:30",
				"end": "2023-12-25T23:24:00+10:30"
			},
			{
				"start": "2023-12-26T00:06:00+10:30",
				"end": "2023-12-26T00:24:00+10:30"
			},
			{
				"start": "2023-12-26T01:06:00+10:30",
				"end": "2023-12-26T01:24:00+10:30"
			},
			{
				"start": "2023-12-26T23:06:00+10:30",
				"end": "2023-12-26T23:24:00+10:30"
			},
			{
				"start": "2023-12-27T00:06:00+10:30",
				"end": "2023-12-27T00:24:00+10:30"
			},
			{
				"start": "2023-12-27T01:06:00+10:30",
				"end": "2023-12-27T01:24:00+10:30"
			},
			{
				"start": "2023-12-27T23:06:00+10:30",
				"end": "2023-12-27T23:24:00+10:30"
			},
			{
				"start": "2023-12-28T00:06:00+10:30",
				"end": "2023-12-28T00:24:00+10:30"
			},
			{
				"start": "2023-12-28T01:06:00+10:30",
				"end": "2023-12-28T01:24:00+10:30"
			},
			{
				"start": "2023-12-28T23:06:00+10:30",
				"end": "2023-12-28T23:24:00+10:30"
			},
			{
				"start": "2023-12-29T00:06:00+10:30",
				"end": "2023-12-29T00:24:00+10:30"
			},
			{
				"start": "2023-12-29T01:06:00+10:30",
				"end": "2023-12-29T01:24:00+10:30"
			},
			{
				"start": "2023-12-29T23:06:00+10:30",
				"end": "2023-12-29T23:24:00+10:30"
			},
			{
				"start": "2023-12-30T00:06:00+10:30",
				"end": "2023-12-30T00:24:00+10:30"
			},
			{
				"start": "2023-12-30T01:06:00+10:30",
				"end": "2023-12-30T01:24:00+10:30"
			},
			{
				"start": "2023-12-30T23:06:00+10:30",
				"end": "2023-12-30T23:24:00+10:30"
			},
			{
				"start": "2023-12-31T00:06:00+10:30",
				"end": "2023-12-31T00:24:00+10:30"
			},
			{
				"start": "2023-12-31T01:06:00+10:30",
				"end": "2023-12-31T01:24:00+10:30"
			},
			{
				"start": "2023-12-31T23:06:00+10:30",
				"end": "2023-12-31T23:24:00+10:30"
			},
			{
				"start": "2024-01-01T00:06:00+10:30",
				"end": "2024-01-01T00:24:00+10:30"
			},
			{
				"start": "2024-01-01T01:06:00+10:30",
				"end": "2024-01-01T01:24:00+10:30"
			},
			{
				"start": "2024-01-01T23:06:00+10:30",
				"end": "2024-01-01T23:24:00+10:30"
			},
			{
				"start": "2024-01-02T00:06:00+10:30",
				"end": "2024-01-02T00:24:00+10:30"
			},
			{
				"start": "2024-01-02T01:06:00+10:30",
				"end": "2024-01-02T01:24:00+10:30"
			},
			{
				"start": "2024-01-02T23:06:00+10:30",
				"end": "2024-01-02T23:24:00+10:30"
			},
			{
				"start": "2024-01-03T00:06:00+10:30",
				"end": "2024-01-03T00:24:00+10:30"
			},
			{
				"start": "2024-01-03T01:06:00+10:30",
				"end": "2024-01-03T01:24:00+10:30"
			},
			{
				"start": "2024-01-03T23:06:00+10:30",
				"end": "2024-01-03T23:24:00+10:30"
			},
			{
				"start": "2024-01-04T00:06:00+10:30",
				"end": "2024-01-04T00:24:00+10:30"
			},
			{
				"start": "2024-01-04T01:06:00+10:30",
				"end": "2024-01-04T01:24:00+10:30"
			},
			{
				"start": "2024-01-04T23:06:00+10:30",
				"end": "2024-01-04T23:24:00+10:30"
			},
			{
				"start": "2024-01-05T00:06:00+10:30",
				"end": "2024-01-05T00:24:00+10:30"
			},
			{
				"start": "2024-01-05T01:06:00+10:30",
				"end": "2024-01-05T01:24:00+10:30"
			},
			{
				"start": "2024-01-05T23:06:00+10:30",
				"end": "2024-01-05T23:24:00+10:30"
			},
			{
				"start": "2024-01-06T00:06:00+10:30",
				"end": "2024-01-06T00:24:00+10:30"
			},
			{
				"start": "2024-01-06T01:06:00+10:30",
				"end": "2024-01-06T01:24:00+10:30"
			},
			{
				"start": "2024-01-06T23:06:00+10:30",
				"end": "2024-01-06T23:24:00+10:30"
			}
		]
	}
}
